{% extends 'main.html' %}
{% load static %}

{% block static_url %}
{{ block.super }}
<link href="{% static 'css/auth_forms.css' %}" rel="stylesheet">
{% endblock %}

{% block body_content %}
<main class="column-container">
    <div class="main column-container feature">
        <div class="header">
            <div class="row-container header2">
                <h3>{% if view.title %}{{ view.title }}{% else %}Password Reset{% endif %}</h3>
            </div>
        </div>
        <div class="divider"></div>

        <div class="password-reset-container">
            {% if validlink is False %}
                <div class="error-message">
                    <p>The password reset link was invalid, possibly because it has already been used or expired.</p>
                    <p>Please request a <a href="{% url 'password_reset' %}">new password reset</a>.</p>
                </div>
            {% elif complete %}
                <div class="success-message">
                    <p>Your password has been set.</p>
                </div>
                <div class="form-actions">
                    <a href="{% url 'login' %}" class="main-button">Log in</a>
                </div>
            {% elif done %}
                <div class="success-message">
                    <p>We've emailed you instructions for setting your password.</p>
                    <p>If you don't receive an email, please make sure you've entered the address you registered with, and check your spam folder.</p>
                </div>
                <div class="form-links">
                    <a href="{% url 'login' %}">Return to login</a>
                </div>
            {% elif validlink %}
                <!-- Password reset confirmation form -->
                <p>Please enter your new password.</p>
                
                <form method="post" class="password-reset-form">
                    {% csrf_token %}
                    
                    {% if form.new_password1.errors %}
                    <div class="error-message">
                        {{ form.new_password1.errors }}
                    </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <label for="id_new_password1">New password:</label>
                        <input type="password" name="new_password1" required id="id_new_password1" class="form-input">
                        <p class="help-text">Your password must contain at least 8 characters and can't be entirely numeric.</p>
                    </div>
                    
                    {% if form.new_password2.errors %}
                    <div class="error-message">
                        {{ form.new_password2.errors }}
                    </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <label for="id_new_password2">Confirm password:</label>
                        <input type="password" name="new_password2" required id="id_new_password2" class="form-input">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="main-button">Change my password</button>
                    </div>
                </form>
            {% else %}
                <!-- Password reset request form -->
                <p>Forgot your password? Enter your email address below, and we'll email you instructions for setting a new one.</p>
                
                {% if form.errors %}
                <div class="error-message">
                    <p>Please enter a valid email address.</p>
                </div>
                {% endif %}
                
                <form method="post" class="password-reset-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_email">Email address:</label>
                        <input type="email" name="email" maxlength="254" required id="id_email" class="form-input">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="main-button">Send reset link</button>
                    </div>
                </form>
                
                <div class="form-links">
                    <a href="{% url 'login' %}">Return to login</a>
                </div>
            {% endif %}
        </div>
    </div>
</main>
{% endblock %} 